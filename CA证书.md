# CA证书

说到CA证书，我们的第一映像是HTTPS，好像CA证书是用来进行安全通信用的。可以它是如何进行安全通信？，CA证书又是什么？这就不得而知了。

## 加密通信

## 一个加密通信过程的演化

此演示例子引用至：http://www.cnblogs.com/JeffreySun/archive/2010/06/24/1627247.html

为了说明这两个问题，首先来看一个加密通信过程的演化：

我们来看一个例子：现在假设“服务器”和“客户”要在网络上通信，并且它们打算使用RSA（参看附录RSA简介）来对通信进行加密以保证通信内容的安全。由于是使用RSA这种公钥密码体制，“服务器”需要对外发布公钥（如何公布，后面再讲），自己保留私钥。“客户”通过某些途径拿到了“服务器”发布的公钥，“客户”并不知道私钥。下面我们再来看一下双方如何进行安全通信：

### NO.1

```
客户—>服务器：你好
客户<—服务器：你好，我是服务器
客户—>服务器：你好，这是我的银行卡密码
```

这里有个问题，因为消息是网络上传递的，所以黑客可以拦截“客户”和“服务器”之间的通信，在客户不知道的情况下，冒充服务器，如下：

```
# 黑客拦截了客服发给服务器的请求
客户—>黑客：你好
客户<—黑客：你好，我是服务器
客户—>黑客：你好，这是我的银行卡密码
```

### NO.2

黑客拿到了你的银行卡密码会发生什么还用说吗。那怎么办呢？使用RSA加密？没错，使用RSA确实可以解决黑客冒充的问题。过程如下：

```
客户—>服务器：(RSA publicKey)你好
客户<—服务器：(RSA privateKey)你好，我是服务器
客户—>服务器：(RSA publicKey)你好，这是我的银行卡密码
```

客服使用服务器的公钥对信息加密，服务器使用自己的私钥对信息加密。

假设黑客冒充服务器会怎样呢？

```
客户—>黑客：(RSA publicKey)你好
	黑客解密：？？？
客户<—黑客：(RSA privateKey)你好，我是服务器
	客户解密：？？？
客户—>黑客：？？？
```

因为黑客是没有服务器的私钥的，所以客户用服务器公钥加密的内容黑客是无法解密的。同样，黑客发送给客户的内容要么没有加密，要么加密了，但是无论如何，客户都不可能用服务器的公钥对其进行解密。如果能够解密，那么就就可以证明，这个消息必定是服务器发送过来的。

### NO.3

到了这里，确实可以证明信息交互的对象确实是服务器。但是，即使是这样，还是不能保证信息的安全，为什么呢？不是已经使用了RSA公私钥加密了吗？因为公钥是公开的，虽然因为私钥只有服务器知道，黑客无法解密客户发送给服务器的信息，但是服务器发给客户的信息，黑客是可以解密的。

```
客户—>服务器：(RSA publicKey)你好
客户<—服务器：(RSA privateKey)你好，我是服务器
客户—>服务器：(RSA publicKey)你好，我申请一个账号密码
客户<—服务器：(RSA privateKey)你好，你的账号密码是******
```

黑客只要拦截客户与服务器交互的信息，用服务器公开的公钥解密服务器发给客户的信息，就可以知道客户的账号密码是什么了。那怎么办呢？可以引入DES对称加密来解决这个问题。请看下面的演示：

### NO.4

```
客户—>服务器：(RSA publicKey)你好
客户<—服务器：(RSA privateKey)你好，我是服务器{这里就可以确认服务器的身份了}
客户—>服务器：(RSA publicKey)你好，这是对称加密秘钥
客户<—服务器：(DES key)好的，已收到DES秘钥
客户—>服务器：(DES key)我申请一个账号密码
客户<—服务器：(DES key)你的账号密码是******
```

客户在确认交互的对象确实是服务器之后，就生成一个秘钥和选择一个对称加密算法，将对称加密算法和秘钥使用服务器的公钥加密之后发送给服务器（因为使用了服务器的公钥加密，黑客就算拿到了加密信息，也不能解密从而知道对称加密信息）。服务器使用自己的私钥对其进行解密，从而就生成了一个只有客户和服务器知道的对称加密算法和秘钥了，之后的信息交互就使用对称加密算法进行交互。

### 总结

- 因为私钥只有服务器拥有，因此“客户”可以通过判断对方是否有私钥来判断对方是否是“服务器”。
- 客户通过RSA的掩护，安全地和服务器商量好一个对称加密算法和秘钥来保护后面的通信内容的安全。

到了这里，客户和服务器的通信好像比较安全了。但是又回到最初的问题，那就是服务器如何发布自己的公钥呢，并使客户知道？我们可能会想到三个方法：

1. 把公钥放到互联网的一个指定地址，事先客户去下载。
2. 和客户联系，事先将公钥告诉它，比如线下联系等。
3. 每次通信交互时，将公钥发给客户。

对于第一个方式，客户凭什么这个下载地址是下载的公钥是服务器，而不是别人冒充的；

对于第二种方式，互联网的用户成千上万，难道和每一个都去联系？

对于第三种方式，黑客可以直接拦截将自己的公钥发给客户；

那么怎么办呢？如果能够证明拿到的公钥确实是服务器的就好了。为了解决这个问题，数字证书出现了，数字证书可以解决上面的问题。那么数字证书又是什么呢？

## 数字证书

下面是百科百科的描述：

> 数字证书就是互联网通讯中标志通讯各方身份信息的一串数字，提供了一种在Internet上验证通信实体身份的方式，数字证书不是[数字身份证](https://baike.baidu.com/item/%E6%95%B0%E5%AD%97%E8%BA%AB%E4%BB%BD%E8%AF%81/680163)，而是身份认证机构盖在数字身份证上的一个章或印（或者说加在数字身份证上的一个签名）。它是由权威机构——CA机构，又称为证书授权（Certificate Authority）中心发行的，人们可以在网上用它来识别对方的身份。

简单来说，数字证书就是由CA机构发行认证的存储有通讯各方身份信息的一串数字，通过这串数字，可以验证通讯实体（比如这里的服务器）的身份。



首先服务器向CA机构申请一张数字证书，CA机构认证通过之后发给服务器一个秘钥存储库，存储库中包含了RSA秘钥和证书，证书中包含的实体（服务器）的身份信息以及秘钥对应的公钥。存储库在发给服务器之前已经被CA机构使用它自己的私钥进行加密了。

然后客户与服务器交互，客户在与服务其首次交互的时候，服务器将它的证书发送给客户，客户在本地受信任的证书链中找到服务器发送的证书的签发CA机构的根证书，使用根证书中的公钥对其进行解密，从而可以得到服务器公钥。

到了这里大家可能又会有疑惑了，黑客难道不能生成一个自己的证书，替换服务器发给客户的证书吗？针对这个问题，因为这个证书是黑客自己签发的，不是由CA机构签发的，所以它是不被信任的，客户也找不到对应的根证书公钥对其进行解密。那如果黑客搞了一个受信任的证书怎么办呢？这就是CA机构的问题了，出现了这样的问题，CA机构是要承担相应的法律责任的。

但是仅仅这样还不够，客户可以获取对应服务器证书的根证书的公钥，那么黑客同样也可以，如果黑客篡改了证书的内容怎么办

## 数字签名



## CA认证



## CA证书



## SSL证书



CA也拥有一个证书（内含公钥和私钥）。网上的公众用户通过验证CA的签字从而信任CA，任何人都可以得到CA的证书（含公钥），用以验证它（CA）所签发的证书。

​	如果用户想得到一份属于自己的证书，他应先向CA提出申请，在CA判明申请者身份后，便为他分配一个公钥，并且CA将该公钥与申请者的身份信息绑在一起，并为之签字后，便形成证书发给申请者。

​	如果一个用户想鉴别另一个证书的真伪，他就用CA的公钥对那个证书上的签字进行验证，一旦验证通过，该证书就被认为是有效的。证书实际是由证书签证机关（CA）签发的对用户的公钥的认证。

​	证书的内容包括：电子签证机关的信息、公钥用户信息、公钥、权威机构的签字和有效期等等。目前，证书的格式和验证方法普遍遵循X.509国际标准。

## 加密

## 解密

## 方法

信息发送者用其私钥对从所传报文中提取出的特征数据（或称数字指纹）进行RSA算法操作，以保证发信人无法抵赖曾发过该信息（即不可地抵赖性），同时也确保信息报文在传递过程中未被篡改（即完整性）。当信息受者收到报文后，就可以用发送者的公钥对数字签名进行验证。

在数字签名中有重要作用的数字指纹是通过一类特殊的散列函数（HASH函数）生成的。

### 流程

1. 接受的输入报文数据没有长度限制；
2. 对任何输入报文数据生成固定长度的摘要（数字指纹）输出；
3. 从报文能方便地算出摘要；
4. 难以对指定的摘要生成一个报文，而由该报文可以算出该指定的摘要；
5. 难以生成两个不同的报文具有相同的摘要。

**验证：**

收方在收到信息后用如下的步骤验证签名：

1. 使用自己的私钥将信息转为明文；
2. 使用发信方的公钥从数字签名部分得到原摘要；
3. 收方对您所发送 的源信息进行hash运算，也产生一个摘要；
4. 收方比较两个摘要，如果两者相同，则可以证明信息签名者的身份。

如果两摘要内容不符，会说明什么原因呢？

可能对摘要进行签名所用的私钥不是签名者的私钥，这就表明信息的签名者不可信，也可能收到的信息根本就不是签发者发送的信息，信息在传输过程中已经遭到破坏或篡改。

## 数字证书

数字证书为实现双方安全通信提供了电子认证。在因特网、公司内部网或外部网中，使用数字证书实现身份识别和电子信息加密。数字证书中含有秘钥对（公钥和私钥）所有者的识别信息，通过验证识别信息的真伪实现对证书持有者身份的认证。

【公钥】【源信息】【签名】