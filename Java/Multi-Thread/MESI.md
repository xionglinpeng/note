# 缓存一致性协议





我的疑问是，既然一个cpu在把缓存行写入到内存，同时让其他处理器的缓存行无效，那么其他处理器势必要读取相应的内存地址，而此时的内存正在被第一个cpu写入，可能还没有写完。那么如果第一个cpu不锁定总线的话，其他cpu读入的就是没有写完的脏数据或者是老数据啊。
如果不锁定总线，如何能够做到缓存一致? 该怎么理解呢?





[总线锁 缓存锁](https://www.cnblogs.com/xcyz/p/7868674.html)

总线锁：就是使用处理器提供的一个LOCK#信号，当一个处理器在总线上输此信号时，其他处理器的请求将被阻塞住，那么该处理器可以独占共享内存。

缓存锁：所谓“缓存锁定”是指内存区域如果被缓存在处理器的缓存行中，并且在Lock操作期间被锁定，那么当它执行锁操作回写到内存时，处理器不在总线上声言LOCK#信号，而是修改内部的内存地址，并允许它的缓存一致性机制来保证操作的原子性，因为缓存一致性机制会阻止同时修改由两个以上处理器缓存的内存区域数据，当其他处理器回写已被锁定的缓存行数据时，会使缓存行无效。