# 用户和用户组管理

## 用户信息文件

```shell
[root@localhost ~]# cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
operator:x:11:0:operator:/root:/sbin/nologin
games:x:12:100:games:/usr/games:/sbin/nologin
ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin
nobody:x:99:99:Nobody:/:/sbin/nologin
systemd-network:x:192:192:systemd Network Management:/:/sbin/nologin
dbus:x:81:81:System message bus:/:/sbin/nologin
polkitd:x:999:998:User for polkitd:/:/sbin/nologin
sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin
postfix:x:89:89::/var/spool/postfix:/sbin/nologin
chrony:x:998:996::/var/lib/chrony:/sbin/nologin
```

1. 用户名
2. 密码标志
3. UID
4. GID
5. 用户说明
6. 家目录
7. 登录之后的shell

影子文件/etc/shadow

```shell
$ cat /etc/shadow | head -10
root:!:18179:0:99999:7:::
daemon:*:16911:0:99999:7:::
bin:*:16911:0:99999:7:::
sys:*:16911:0:99999:7:::
sync:*:16911:0:99999:7:::
games:*:16911:0:99999:7:::
man:*:16911:0:99999:7:::
lp:*:16911:0:99999:7:::
mail:*:16911:0:99999:7:::
news:*:16911:0:99999:7:::
```

1. 用户名称
2. 密码
3. 密码最后一次修改日期
4. 密码的两次修改间隔时间（和第三个字段相比）
5. 密码的有效期（和第三个字段相比）
6. 密码修改到期前的警告天数（和第五个字段相比）
7. 密码过期后的宽限天数（和第五个字段相比）
8. 账号失效时间
9. 保留

组信息文件/etc/group

```shell
$ cat /etc/group | head -n 10
root:x:0:
daemon:x:1:
bin:x:2:
sys:x:3:
adm:x:4:syslog,jusda
tty:x:5:
disk:x:6:
lp:x:7:
mail:x:8:
news:x:9:
```

1. 组名
2. 组密码标志
3. 组ID（GID）
4. 组中的用户

组密码文件/

```shell
$ cat /etc/gshadow | head -n 10
root:*::
daemon:*::
bin:*::
sys:*::
adm:*::syslog,jusda
tty:*::
disk:*::
lp:*::
mail:*::
news:*::
```

1. 组名
2. 组密码
3. 组管理员用户名
4. 组中的附加用户



用户管理相关文件

1. 用户家目录
2. 用户邮箱目录
3. 用户模板目录

## 用户管理命令

### 添加用户：useradd



```shell
[root@localhost ~]# useradd -help
用法：useradd [选项] 登录
      useradd -D
      useradd -D [选项]

选项：
  -b, --base-dir BASE_DIR	新账户的主目录的基目录
  -c, --comment COMMENT         新账户的 GECOS 字段
  -d, --home-dir HOME_DIR       新账户的主目录
  -D, --defaults		显示或更改默认的 useradd 配置
 -e, --expiredate EXPIRE_DATE  新账户的过期日期
  -f, --inactive INACTIVE       新账户的密码不活动期
  -g, --gid GROUP		新账户主组的名称或 ID
  -G, --groups GROUPS	新账户的附加组列表
  -h, --help                    显示此帮助信息并推出
  -k, --skel SKEL_DIR	使用此目录作为骨架目录
  -K, --key KEY=VALUE           不使用 /etc/login.defs 中的默认值
  -l, --no-log-init	不要将此用户添加到最近登录和登录失败数据库
  -m, --create-home	创建用户的主目录
  -M, --no-create-home		不创建用户的主目录
  -N, --no-user-group	不创建同名的组
  -o, --non-unique		允许使用重复的 UID 创建用户
  -p, --password PASSWORD		加密后的新账户密码
  -r, --system                  创建一个系统账户
  -R, --root CHROOT_DIR         chroot 到的目录
  -P, --prefix PREFIX_DIR       prefix directory where are located the /etc/* files
  -s, --shell SHELL		新账户的登录 shell
  -u, --uid UID			新账户的用户 ID
  -U, --user-group		创建与用户同名的组
  -Z, --selinux-user SEUSER		为 SELinux 用户映射使用指定 SEUSER
```



1. 添加默认用户

   ```shell
   $ useradd lamp
   ```

   此命令完成的工作：

   1. 在/etc/passwd文件中按照文件格式添加lamp用户行。

      ```shell
      $ cat /etc/passwd | grep lamp
      lamp:x:1000:1000::/home/lamp:/bin/bash
      ```

      **注意**：用户的UID（第三个）是从500开始计算的。同时默认指定了用户的主目录为`/home/lamp`，登录shell为`/bin/bash`。

   2. 在/etc/shadow文件中建立用户lamp相关行。

      ```shell
      $ cat /etc/shadow | grep lamp
      lamp:!!:18406:0:99999:7:::
      ```

      这个用户还没有设置密码，所以密码字段是`!!`，代表此用户没有密码，不能登录。

   3. 在/etc/group文件中建立用户lamp相关行。

      ```shell
      $ cat /etc/group | grep lamp
      lamp:x:1000:
      ```

      因为lamp组就是lamp用户的初始组，所以lamp用户名不会写入第四个字段。

   4. 在/etc/gshadow文件中建立用户lamp相关行。

      ```shell
      [root@localhost ~]# cat /etc/gshadow | grep lamp
      lamp:!::
      ```

      没有组密码，也没有组管理员。

   5. 建立用户主目录和邮件池。

      ```shell
      $ ll -d /home/lamp/
      drwx------. 2 lamp lamp 62 5月  24 14:21 /home/lamp/
      $ ll /var/spool/mail/lamp 
      -rw-rw----. 1 lamp mail 0 5月  24 14:21 /var/spool/mail/lamp
      ```

      注意这两个文件权限。

2. 手工指定选项添加用户

   是的

   ```shell
   $ groupadd lamp1
   $ useradd -u 550 -g lamp1 -G root -d /home/lamp1 -c "test user" -s /bin/bash lamp1
   ```

   



useradd命令的默认值设定





1. 修改用户密码：passwd
2. 修改用户信息：usermod
3. 修改用户密码状态：chage





### 删除用户：userdel



```shell
[root@localhost ~]# userdel --help
用法：userdel [选项] 登录

选项：
  -f, --force                   force some actions that would fail otherwise
                                e.g. removal of user still logged in
                                or files, even if not owned by the user
  -h, --help                    显示此帮助信息并推出
  -r, --remove                  删除主目录和邮件池
  -R, --root CHROOT_DIR         chroot 到的目录
  -P, --prefix PREFIX_DIR       prefix directory where are located the /etc/* files
  -Z, --selinux-user            为用户删除所有的 SELinux 用户映射
```

1. 命令删除用户

   ```shell
   $ userdel -r lamp
   ```

   在删除用户时指定`-r`选择，以用于删除主目录和邮件池，如果不指定`-r`选项，那么主目录和邮件池将会变成没有属主和属组的目录，也就是垃圾文件。

2. 手工删除用户









1. 查看用户的UID和GID：id
2. 切换用户身份：su

## 用户组管理命令

1. 添加用户组：groupadd
2. 修改用户组：groupmod
3. 删除用户组：groupdel
4. 把用户添加进组或从组中删除：gpasswd
5. 改变有效组：newgrp



SELinux管理

SELinux是由美国国家安全局（NSA）开发的，整合在Linux内核中，针对特定的进程与指定的文件资源进行权限控制的系统。

即使你是root用户，也必须遵守SELinux的规则，才能正确访问正确的资源，这样可以有效的防止root用户的误操作（当然，root用户可以修改SELinux的规则）。